{% extends "base.html" %}

{% block title %}æœ¬æ—¥è¨˜å¸³ - è¨˜å¸³ç®¡å®¶{% endblock %}
{% block page_title %}ğŸ“… æœ¬æ—¥ç²¾ç¢ºè¨˜å¸³{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/expense.css') }}">
{% endblock %}

{% block content %}
<!-- Horizontal Navigation Bar -->
<div class="salary-nav">
    <a href="{{ url_for('expense.today') }}"
        class="salary-nav-item {% if request.endpoint == 'expense.today' %}active{% endif %}">
        ğŸ“… æœ¬æ—¥è¨˜å¸³
    </a>
    <a href="{{ url_for('expense.index') }}"
        class="salary-nav-item {% if request.endpoint == 'expense.index' %}active{% endif %}">
        ğŸ“Š æœ¬é€±æœŸ
    </a>
    <a href="{{ url_for('expense.history') }}"
        class="salary-nav-item {% if request.endpoint == 'expense.history' %}active{% endif %}">
        ğŸ“œ æ­·å²
    </a>
    <a href="{{ url_for('expense.settings') }}"
        class="salary-nav-item {% if request.endpoint == 'expense.settings' %}active{% endif %}">
        âš™ï¸ è¨­å®š
    </a>
</div>

<div class="today-view">
    <!-- Today's Total Summary -->
    <div class="today-summary-header" style="margin-bottom: 25px;">
        <div class="card expense-summary-card glass-premium"
            style="text-align: center; padding: 25px; margin-bottom: 15px;">
            <span class="label"
                style="font-size: 0.9rem; opacity: 0.7; display: block; margin-bottom: 5px;">ä»Šæ—¥ç´¯è¨ˆæ”¯å‡º</span>
            <span class="value" id="todayTotalAmount"
                style="font-size: 2.2rem; font-weight: 800; color: var(--accent-color);">$0</span>
        </div>

        <!-- Monthly Budget Status -->
        <div class="card expense-summary-card glass-premium" style="padding: 15px 20px;">
            <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 5px;">
                <span style="font-size: 0.9rem; opacity: 0.7;">æœ¬æœˆé ç®—å‰©é¤˜</span>
                <span id="remainingBudget" style="font-size: 1.2rem; font-weight: 700;">$0</span>
            </div>
            <div class="progress-bar-container"
                style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                <div id="budgetProgress"
                    style="width: 0%; height: 100%; background: var(--accent-color); transition: width 0.5s;"></div>
            </div>
        </div>
    </div>

    <!-- Quick Add Bar -->

    <div class="quick-add-container" style="margin-bottom: 30px;">
        <button class="btn btn-primary btn-block" id="openAddExpenseBtn"
            style="height: 60px; font-size: 1.1rem; border-radius: 16px;">
            <span class="material-icons">add_circle_outline</span> æ–°å¢ä»Šæ—¥ç´€éŒ„
        </button>
    </div>

    <!-- Today's List -->
    <div class="expense-list-container">
        <h3 class="section-title">ä»Šæ—¥æ´»å‹•</h3>
        <div id="expenseList" class="expense-list">
            <!-- Records injected here -->
            <div class="loading-placeholder">è¼‰å…¥ä¸­...</div>
        </div>
    </div>
</div>

<!-- Add/Edit Expense Modal -->
<div id="expenseModal" class="modal">
    <div class="modal-content glass">
        <div class="modal-header">
            <h3 id="modalTitle">æ–°å¢æ”¯å‡º</h3>
            <span class="close-modal" id="closeExpenseModalBtn">&times;</span>
        </div>
        <div class="modal-body">
            <form id="expenseForm">
                <input type="hidden" name="id" id="expenseId">
                <div class="form-group">
                    <label>é …ç›®åç¨±</label>
                    <input type="text" name="note" id="expenseNote" placeholder="ä¾‹å¦‚ï¼šåˆé¤..." required>
                    <div class="quick-tags" id="mealQuickTags">
                        <!-- Dynamic tags injected here -->
                    </div>

                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>é‡‘é¡ (NTD)</label>
                        <input type="number" name="amount" id="expenseAmount" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>é¡åˆ¥</label>
                        <select name="category" id="expenseCategory">
                            <option value="é£²é£Ÿ" selected>ğŸ½ï¸ é£²é£Ÿ</option>
                            <option value="è¡£è‘—">ğŸ‘• è¡£è‘—</option>
                            <option value="äº¤é€š">ğŸšŒ äº¤é€š</option>
                            <option value="å…¶ä»–">ğŸ“¦ å…¶ä»–</option>
                        </select>


                    </div>
                </div>
                <div class="form-group">
                    <div class="date-time-row">
                        <input type="date" id="expenseDate" class="input-pill" required>
                        <input type="time" id="expenseTime" class="input-pill" required>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger hidden" id="deleteExpenseBtn">åˆªé™¤</button>
                    <button type="submit" class="btn btn-primary">å„²å­˜</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/expense.js') }}"></script>
{% endblock %}